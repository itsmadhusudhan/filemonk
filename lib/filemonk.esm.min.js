function e(){let e=[];const t=(t,r)=>{e=e.filter((e=>!(e.event===t&&(e.cb===r||!r))))};return{emit:t=>{e.filter((e=>e.event===t.type)).map((e=>e.cb.bind(e))).forEach((e=>e({type:t.type,data:t.data})))},subscribe:(t,r)=>{e.push({event:t,cb:r})},subscribeOnce:(r,s)=>{e.push({event:r,cb(...e){t(r,this.cb),s(...e)}})},unsubscribe:t}}var t,r=new Uint8Array(16);function s(){if(!t&&!(t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(r)}var n=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function a(e){return"string"==typeof e&&n.test(e)}for(var i=[],o=0;o<256;++o)i.push((o+256).toString(16).substr(1));function E(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase();if(!a(r))throw TypeError("Stringified UUID is invalid");return r}function u(e,t,r){function s(e,s,n,i){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof s&&(s=function(e){if(!a(e))throw TypeError("Invalid UUID");var t,r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r}(s)),16!==s.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var o=new Uint8Array(16+e.length);if(o.set(s),o.set(e,s.length),(o=r(o))[6]=15&o[6]|t,o[8]=63&o[8]|128,n){i=i||0;for(var u=0;u<16;++u)n[i+u]=o[u];return n}return E(o)}try{s.name=e}catch(e){}return s.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",s.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",s}function c(e){return 14+(e+64>>>9<<4)+1}function _(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function S(e,t,r,s,n,a){return _((i=_(_(t,e),_(s,a)))<<(o=n)|i>>>32-o,r);var i,o}function l(e,t,r,s,n,a,i){return S(t&r|~t&s,e,t,n,a,i)}function p(e,t,r,s,n,a,i){return S(t&s|r&~s,e,t,n,a,i)}function I(e,t,r,s,n,a,i){return S(t^r^s,e,t,n,a,i)}function g(e,t,r,s,n,a,i){return S(r^(t|~s),e,t,n,a,i)}u("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var r=0;r<t.length;++r)e[r]=t.charCodeAt(r)}return function(e){for(var t=[],r=32*e.length,s="0123456789abcdef",n=0;n<r;n+=8){var a=e[n>>5]>>>n%32&255,i=parseInt(s.charAt(a>>>4&15)+s.charAt(15&a),16);t.push(i)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[c(t)-1]=t;for(var r=1732584193,s=-271733879,n=-1732584194,a=271733878,i=0;i<e.length;i+=16){var o=r,E=s,u=n,S=a;r=l(r,s,n,a,e[i],7,-680876936),a=l(a,r,s,n,e[i+1],12,-389564586),n=l(n,a,r,s,e[i+2],17,606105819),s=l(s,n,a,r,e[i+3],22,-1044525330),r=l(r,s,n,a,e[i+4],7,-176418897),a=l(a,r,s,n,e[i+5],12,1200080426),n=l(n,a,r,s,e[i+6],17,-1473231341),s=l(s,n,a,r,e[i+7],22,-45705983),r=l(r,s,n,a,e[i+8],7,1770035416),a=l(a,r,s,n,e[i+9],12,-1958414417),n=l(n,a,r,s,e[i+10],17,-42063),s=l(s,n,a,r,e[i+11],22,-1990404162),r=l(r,s,n,a,e[i+12],7,1804603682),a=l(a,r,s,n,e[i+13],12,-40341101),n=l(n,a,r,s,e[i+14],17,-1502002290),r=p(r,s=l(s,n,a,r,e[i+15],22,1236535329),n,a,e[i+1],5,-165796510),a=p(a,r,s,n,e[i+6],9,-1069501632),n=p(n,a,r,s,e[i+11],14,643717713),s=p(s,n,a,r,e[i],20,-373897302),r=p(r,s,n,a,e[i+5],5,-701558691),a=p(a,r,s,n,e[i+10],9,38016083),n=p(n,a,r,s,e[i+15],14,-660478335),s=p(s,n,a,r,e[i+4],20,-405537848),r=p(r,s,n,a,e[i+9],5,568446438),a=p(a,r,s,n,e[i+14],9,-1019803690),n=p(n,a,r,s,e[i+3],14,-187363961),s=p(s,n,a,r,e[i+8],20,1163531501),r=p(r,s,n,a,e[i+13],5,-1444681467),a=p(a,r,s,n,e[i+2],9,-51403784),n=p(n,a,r,s,e[i+7],14,1735328473),r=I(r,s=p(s,n,a,r,e[i+12],20,-1926607734),n,a,e[i+5],4,-378558),a=I(a,r,s,n,e[i+8],11,-2022574463),n=I(n,a,r,s,e[i+11],16,1839030562),s=I(s,n,a,r,e[i+14],23,-35309556),r=I(r,s,n,a,e[i+1],4,-1530992060),a=I(a,r,s,n,e[i+4],11,1272893353),n=I(n,a,r,s,e[i+7],16,-155497632),s=I(s,n,a,r,e[i+10],23,-1094730640),r=I(r,s,n,a,e[i+13],4,681279174),a=I(a,r,s,n,e[i],11,-358537222),n=I(n,a,r,s,e[i+3],16,-722521979),s=I(s,n,a,r,e[i+6],23,76029189),r=I(r,s,n,a,e[i+9],4,-640364487),a=I(a,r,s,n,e[i+12],11,-421815835),n=I(n,a,r,s,e[i+15],16,530742520),r=g(r,s=I(s,n,a,r,e[i+2],23,-995338651),n,a,e[i],6,-198630844),a=g(a,r,s,n,e[i+7],10,1126891415),n=g(n,a,r,s,e[i+14],15,-1416354905),s=g(s,n,a,r,e[i+5],21,-57434055),r=g(r,s,n,a,e[i+12],6,1700485571),a=g(a,r,s,n,e[i+3],10,-1894986606),n=g(n,a,r,s,e[i+10],15,-1051523),s=g(s,n,a,r,e[i+1],21,-2054922799),r=g(r,s,n,a,e[i+8],6,1873313359),a=g(a,r,s,n,e[i+15],10,-30611744),n=g(n,a,r,s,e[i+6],15,-1560198380),s=g(s,n,a,r,e[i+13],21,1309151649),r=g(r,s,n,a,e[i+4],6,-145523070),a=g(a,r,s,n,e[i+11],10,-1120210379),n=g(n,a,r,s,e[i+2],15,718787259),s=g(s,n,a,r,e[i+9],21,-343485551),r=_(r,o),s=_(s,E),n=_(n,u),a=_(a,S)}return[r,s,n,a]}(function(e){if(0===e.length)return[];for(var t=8*e.length,r=new Uint32Array(c(t)),s=0;s<t;s+=8)r[s>>5]|=(255&e[s/8])<<s%32;return r}(e),8*e.length))}));function f(e,t,r){var n=(e=e||{}).random||(e.rng||s)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var a=0;a<16;++a)t[r+a]=n[a];return t}return E(n)}function d(e,t,r,s){switch(e){case 0:return t&r^~t&s;case 1:case 3:return t^r^s;case 2:return t&r^t&s^r&s}}function O(e,t){return e<<t|e>>>32-t}u("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var s=unescape(encodeURIComponent(e));e=[];for(var n=0;n<s.length;++n)e.push(s.charCodeAt(n))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var a=e.length/4+2,i=Math.ceil(a/16),o=new Array(i),E=0;E<i;++E){for(var u=new Uint32Array(16),c=0;c<16;++c)u[c]=e[64*E+4*c]<<24|e[64*E+4*c+1]<<16|e[64*E+4*c+2]<<8|e[64*E+4*c+3];o[E]=u}o[i-1][14]=8*(e.length-1)/Math.pow(2,32),o[i-1][14]=Math.floor(o[i-1][14]),o[i-1][15]=8*(e.length-1)&4294967295;for(var _=0;_<i;++_){for(var S=new Uint32Array(80),l=0;l<16;++l)S[l]=o[_][l];for(var p=16;p<80;++p)S[p]=O(S[p-3]^S[p-8]^S[p-14]^S[p-16],1);for(var I=r[0],g=r[1],f=r[2],L=r[3],C=r[4],P=0;P<80;++P){var D=Math.floor(P/20),h=O(I,5)+d(D,g,f,L)+C+t[D]+S[P]>>>0;C=L,L=f,f=O(g,30)>>>0,g=I,I=h}r[0]=r[0]+I>>>0,r[1]=r[1]+g>>>0,r[2]=r[2]+f>>>0,r[3]=r[3]+L>>>0,r[4]=r[4]+C>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]}));var L=(e=>(e.IDLE="IDLE",e.IN_QUEUE="IN_QUEUE",e.UPLOADING="UPLOADING",e.UPLOADED="UPLOADED",e.FAILED="FAILED",e.CANCELLED="CANCELLED",e))(L||{}),C=(e=>(e.ON_ITEM_UPDATED="ON_ITEM_UPDATED",e.ON_FILE_PROCESS_START="ON_FILE_PROCESS_START",e.ON_FILE_PROCESS_PROGRESS="ON_FILE_PROCESS_PROGRESS",e.ON_FILE_PROCESS_COMPLETE="ON_FILE_PROCESS_COMPLETE",e.ON_FILE_PROCESS_CANCELLED="ON_FILE_PROCESS_CANCELLED",e.ON_FILE_PROCESS_FAILED="ON_FILE_PROCESS_FAILED",e))(C||{});const P="GET_IDLE_ITEMS",D="GET_MAX_PARALLEL_UPLOADS_ITEMS",h="GET_ITEMS_BY_STATUS",T="GET_PROCESSED_ITEMS",R=t=>({CREATE_FILE_ITEM:r=>{const s=((t,r)=>{const s=e();let n={id:f(),file:t,server:r,status:L.IDLE,abortController:new AbortController,progress:0};const a=e=>{n={...n,...e},s.emit({type:C.ON_ITEM_UPDATED})};return{id:{get:()=>n.id},file:{get:()=>n.file},abortController:{get:()=>n.abortController},server:{get:()=>n.server},status:{get:()=>n.status},progress:{get:()=>n.progress},requestProcessing:()=>{a({status:L.IN_QUEUE})},process:async()=>{a({status:L.UPLOADING}),s.emit({type:C.ON_FILE_PROCESS_START});const e=setInterval((()=>{a({progress:n.progress+20}),s.emit({type:C.ON_FILE_PROCESS_PROGRESS,data:{id:n.id,progress:n.progress}}),n.progress>=100&&(clearInterval(e),a({status:L.UPLOADED}),s.emit({type:C.ON_FILE_PROCESS_COMPLETE}))}),1e3);return!0},subscribe:s.subscribe,unsubscribe:s.unsubscribe,subscribeOnce:s.subscribeOnce}})(r.file,r.server);s.subscribe(C.ON_ITEM_UPDATED,(()=>{t.setState({})})),t.dispatch("DID_CREATE_ITEM",s),t.setState({items:[...t.getState().items,s]})},REQUEST_PROCESS_FILE_ITEM:e=>{"IN_QUEUE"!==e.status.get()&&(e.requestProcessing(),t.dispatch("DID_REQUEST_ITEM_PROCESSING",{id:e.id.get(),status:e.status.get()}),t.dispatch("PROCESS_FILE_ITEM",{query:e}))},PROCESS_FILE_ITEM:({query:e})=>{const r="string"==typeof e?t.getState().items.find((t=>t.id.get()===e)):e;if(!r)return void t.dispatch("DID_PROCESSING_FAILED",{message:"File not found",data:e});if(t.query(D)===t.query(h,"UPLOADING").length)return void t.setState({processingQueue:[...t.getState().processingQueue,r.id.get()]});if("UPLOADING"===r.status.get())return;const s=()=>{const e=t.getState(),r=e.processingQueue[0];if(!r)return;t.setState({processingQueue:e.processingQueue.slice(1)});const n=t.getState().items.find((e=>e.id.get()===r));n?t.dispatch("PROCESS_FILE_ITEM",{query:n}):s()};r.subscribeOnce(C.ON_FILE_PROCESS_COMPLETE,(()=>{t.dispatch("DID_PROCESSING_COMPLETE",{item:r}),s();const e=t.query(T);e.length===t.getState().items.length&&t.dispatch("DID_COMPLETE_ITEM_PROCESSING_ALL",{item:e})})),r.process()}}),b=(e,t)=>{let r={items:[],processingQueue:[],maxParallelUploads:t.maxParallelUploads};const s=["DID_CREATE_ITEM","DID_REQUEST_ITEM_PROCESSING","DID_PROCESSING_COMPLETE","DID_COMPLETE_ITEM_PROCESSING_ALL"],n=()=>({...r}),a=t=>{r={...r,...t},e.emit({type:"STORE_UPDATED",data:_.getState()})},i=(t,r)=>{const n=E[t];s.includes(t)&&e.emit({type:t,data:r}),n&&n(r)},o=(e,...t)=>u[e]?u[e](...t):null,E=R({setState:a,getState:n,dispatch:i,query:o}),u=(c={setState:a,getState:n,dispatch:i},{[P]:()=>c.getState().items.filter((e=>e.status.get()===L.IDLE)),[D]:()=>c.getState().maxParallelUploads,[h]:e=>c.getState().items.filter((t=>t.status.get()===e)),[T]:()=>c.getState().items.filter((e=>e.status.get()!==L.IDLE&&e.status.get()!==L.IN_QUEUE&&e.status.get()!==L.UPLOADING))});var c;const _={getState:()=>({...r,items:r.items.map((e=>({...e,status:e.status.get(),progress:e.progress.get(),id:e.id.get(),name:e.file.get().name})))}),dispatch:i,query:o};return _},y=(t={maxParallelUploads:1,name:"fileMonk"})=>{const r=e(),s=b(r,{maxParallelUploads:t.maxParallelUploads}),n=e=>{s.dispatch("REQUEST_PROCESS_FILE_ITEM",e)};return{name:t.name,addFile:(e,t)=>{[{file:e,server:t}].forEach((e=>{s.dispatch("CREATE_FILE_ITEM",e)}))},getState:s.getState,subscribe:r.subscribe,subscribeOnce:r.subscribeOnce,processFiles:()=>{s.query(P).map(n)}}};export{y as createApp};
